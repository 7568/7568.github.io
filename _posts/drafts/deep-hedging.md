# 深度对冲
我们使用深度强化学习这种机器学习算法，提出了一个对衍生品投资组合进行风险对冲的框架，且该衍生品所在的市场是有摩擦的市场，例如市场包含交易费用，流动性限制，或者风险限制。我们讨论了标准的强化学习方法如何能被应用在非线性的激励结构中，例如，在我们案例中的风险衡量。作为一个使用深度学习对随机过程通用的贡献，我们还在4章节中展示了使用我们算法中一系列的受限制的交易策略是完全足够来估计任何优化问题中的 $\epsilon$ 。我们的算法即使是在高维的情况下使用机器学习工具依然能很有效的实现。 它的结构不取决于特殊的市场动态，和不依赖于包括使用流动性衍生品在内的交叉对冲工具。它的计算性能针对不同的投资组合的规模而差异很大，这主要取决于可用对冲工具的数量。我们使用S&P500指数数据来对我们提出的方法进行了实验，显示了在有交易费用的通过Heston模型合成的市场中，我们方法在风险对冲中的有效性，而且我们的结果超过了标准的‘完全市场’的解决方案。

## 1 引言
在金融安全行业，金融衍生品中投资组合的对冲和定价问题对于价格的风险管理是至关重要的。在理想的无摩擦和完全市场中，人们对金融问题使用数学方法提出了一个可行的价格和对冲风险中性理论。大多数情况下，在这一模型中仅仅只对一些主要的资产，例如股票和少数的其他因素进行建模。可以说，对股票建模最成功的模型为Dupire的局部波动性（Local Volatility）。对于风险管理，我们将会计算‘greeks’，不仅仅对现货，而且还对输入参数进行校准，例如远期利率和隐含波动率--即使是这些量实际上不是基础模型中的状态变量。本质上，模型被用于对冲工具和市场信息的一种低维度插值技术，从中得到对冲的决策。在完全市场中假设中，衍生品的投资组合的价格和风险是可加的线性关系。当然这些方法是有限的，而且在任何模型驱动决策的制定过程中，很容易在模型驱动决策实际上不能正确进行对冲的地方想到市场环境。

在真实的市场中，虽然在任何工具中的交易受制于交易费用，永久性的市场影响和流动性限制。而且，任何交易柜台是通常也是受风险和压力的限制或者更加普遍的资本容量的限制。这就需要交易者，通过从完全市场模型中计算greeks，与自己的方法进行隐含的叠加，从而调整交易策略。也指的是价格和风险不是线性关系，而是取决于整体账面：可以降低特定方向的风险的一个新交易是能够对定价更加有利的。这种现象被称为“斧头”。

由于缺乏有效的可选项，所以完全市场模型一直很流行。即使是过去一些年有一些一些令人映像深刻的突破，例如鲁棒对冲或者超对冲，依然很少有能扩展到不依赖于潜在市场动态的大型投资组合工具的方。

我们的深度对冲方法想要高效的解决这些问题。本质上，我们在我们的对冲策略上对交易决策进行神经网络模型；该模型的特征集包含不仅仅是我们对冲工具中的价格，而且也可能包含额外的信息，例如交易信号，新闻分析，或者过去的对冲决策--人类交易员可能会用到，一个真实的机器学习方式的量化信息。

这种深度对冲策略能够以一个非常有效的方式被描述和训练（在经典的语言中进行优化），而且每个算法都是完全模型-自由，和不依赖于选择的市场动态。这就意味着我们能够包含市场摩擦，例如存在交易费用，流动性限制，买卖差价，等那些所有的可能依赖于场景的特征。

建模任务现在相当于指定一个特定的市场场景生成器，损失函数，市场摩擦和交易工具。该方法使得它自己能够很好的满足市场动态的驱动。这也就意味着我们不再需要对每个衍生品使用经典的衍生品价格模型计算greeks。事实上，我们不需要这种“等价鞅测度模型”：我们的方法是greek-free的。取而代之的是，我们现在聚焦于我们模型在真实动态市场中和在我们对冲信号的实际样本之外的表现。

使用高级别的优化器，然后对既定的目标，找到理性的好的策略，从而在训练样本之外有好的对冲表现。在我们的例子中，我们对一个半循环强化学习问题使用Adam梯度下降法来最小化批量训练。

为了展示我们的方法，我们将从Follmer和Leukert和Ilhan的研究中得到想法，并且在凸风险度量下优化衍生品投资组合的对冲。为了能够将我们的方法与经典的完全市场的结果进行比较，我们选择使用一个Heston模型来推动市场。为了展示本方法在实际中也是有效的，这些结果也会在S&P500指数上进行实验。我们重申，我们的方法不会依赖于我们选择的模型。

为了展示我们的算法，我们研究了一下问题：
1. 在5.2章节中，神经网络对冲（对于不同的风险偏好）是如何与在没有交易费用的Heston模型进行比较的？
2. 在5.3章节中，什么是在潜在不同价格单位中的合适的有效交易费用？
3. 在5.4章节中，数值方法能够扩展到高维的空间吗？
4. 在5.5章节中，如何在实际情况下工作，例如，当与在S&P500指数上的日重新校准的B-S模型比较。

我们的分析是基于训练样本之外的模型表现的。

为了将我们的对冲策略进行数值化的计算，我们使用深度神经网络来估计它。我们使用State-of-art 的机器学习优化技术来训练我们的网络，得到一个接近于最优的深度对冲模型。我们方法是通过TENSORFLOW的PYTOHN代码来实现的。在Heston模型中，股票和方差互换是可以同时使用的。即使是对于合适的交易费用进行实验，依然能显示出很好的效果，而且该方法在高维度的设置中依然有效。

### 1.1 与标准的对冲技术进行比较

我们希望强调我们的深度对冲方法是通用的，例如，对于任意的足够富有的市场场景集合，我们能计算以一个有效的方法，在给定任意种类的市场摩擦和任意风险量化方法的任意提前设定好的对冲工具中，计算量化策略。与大多数企业中应用的对冲方法不同的是，我们的对冲方法不是在模型的的框架下来计算的。

我们将我们的方法与一下的标准方法进行了比较：‘使用一个经典的随机价格模型，将他校准到市场数据中，并对一个给定的收益和风险量化方法计算模型的对冲策略’。第一个案例我们使用Heston模型和使用后股票和方差互换作为对冲工具。我们可以选择任何其他的已知的对冲策略。换句话说：我们方法的复杂性不会受路径空间定律的影响。而且我们第二个方法对S&P指数使用标准的经济尺度模型，并且在真实的数据上计算对冲的表现。

当然，在特殊情况下，例如，当在拥有很多可用期权价格数据的单个标的资产上对冲普通期权，已经有了很多很好的研究方法，例如Bates（2005），Alexander and Nogueira（2007），等。这些工作的主要贡献是他们提出的方法不受限于这些条件。我们也想指出的是大多数的标准方法既没有考虑到市场摩擦，也不考虑交易限制。

我们将来计划的工作是量化第一次模型的风险，例如场景生成时候的错误规范，由于我们方法的通用性，所以我们能优化不同的场景生成器。

### 1.2 相关研究

已经有很多关于有对冲摩擦市场的模型。我们仅仅着重标出少数来描述问题的复杂特征。在有交易费用的情况下，研究对冲和效用无差异定价的研究有Hodges（1989），Davis（1993）。这些研究中很明确的一点是，即使实在B-S模型中对看涨期权计算指数效用无差异价格都需要去解决多维的非线性的无边界问题。这些研究推动了策略和价格的渐进行为的研究，例如Whalley（1997）等。对于引用列表的扩展，当中也覆盖了在有交易费用下的可选方法和投资组合选择问题。

与我们研究最接近的我们认为是Rogers（2010），而且我们的框架设置中也包含了这个研究。在这个研究中，作者研究有二次方的交易费用的市场，这个交易费用被解释为临时的价格影响。定价过程通过一维的B-S模型来建模的。通过解决有三对（非线性）PDE函数的系统来获得最有的交易策略。在Bank（2017）的研究中对Bachelier模型提出了一个更加普遍的跟踪问题，而且还获得了一个非常接近的策略解决办法。Soner（1995）证明在 B-S 市场中一个合适的交易费用，最便宜的超级对冲价格是欧式看涨期权是标的资产的现货价格。因此，“超级-复制”的概念是在一维的情况下对于交易者没什么吸引力。在高维的情况下又会遇到数值难以处理的问题。

总所周知，深度前馈神经网络能够满足普遍的估计问题，例如Hornik（1991）。为了更好的理解为什么他们能在估计对冲策列中如此有效，我们依赖于最新Bolcsker（2017）中的惊艳的效果，可以描述成如下：他们量化允许在提前设置好的方法的类中估计所有元素的值到一个指定的误差范围内必要的网络连接，这样就在估计网络和方法类的估计的复杂性中建立一个普遍的连接。建立了一个用来估计最有M对冲估计结果的神经网络，用来转换最优化M项的估计结果到表示系统的M对冲估计结果。这些转换的结果通过神经网络表示成字典的格式，Bolcskei（2017）还展示了一个宽泛的表示系统类，叫微调系统，而且还包含作为特殊情况的小波，脊波，曲波，剪切波，alpha-剪切波，更一般的，alpha-分子及其张量乘积可以通过神经网络重新表示。这些结果为神经网络无原因有效的提供一种解释：他们有效的将所有微调系统的的最优估计属性结合在一起。在我们的深度对冲策略中这意味着:对于最优化对冲策略，可理解的输入相关因素，能够有效的写下来。

在金融邻域中使用强化学习已经有一些相关研究，他们都有相同的挑战，这里我们着重提出两条主流相关工作，第一是分类的投资组合优化问题，例如对于期权和标的资产没有市场价格对所有的对冲工具都可用的假设。例如Moody（1997）或者Jiang（2017）。第二个强化学习有前途的应用是程式化交易，该工作也有好几位作者提出过很好的结果，例如Du（2009）和Lu（2017）。

本文的创新点是我们将衍生品放在首位，而且在实际中，柜台之外的衍生品是没有可获得的价格的，例如Haoperin（2017）使用Q学习所包含的对冲仅仅是在B-S假设下而且没有交易费用的股票模型的。他们文章中提出了一个不连续时间的对冲方法，使用均值方法类型的优化准则和旨在学习行为价值的方法，这种方法通过用户选择偏好函数的集合来进行参数化。与我们方法的主要不同是不处理如何整合多个对冲共和和市场摩擦的问题，例如交易费用。

最后，我们指出如果一个衍生品的流动性非常好，而且有大量的可用的历史数据，那么最先提出的可用方法是Huechinson（1994），他使用神经网络和使用基于优化神经网络价格方法的greeks对冲策略，来估计衍生品的价格。深度方法被直接提出，来参数化对冲策略和应用到没有或者很少可用的衍生品价格数据上。而且，深度对冲方法允许整合多个对冲工具和市场摩擦。

我们的文章主要邻域是在定价和风险管理，也就是在有摩擦的非完全市场中的债券问题。一个普遍聚焦于这种市场的量化金融的介绍研究为Follmer（2016）

### 1.3 总体结构

本文接下来的结构如下：在第2和3章节中我们在有摩擦的不连续时间市场中提出价格的理论框架和使用凸风险测度。第4章节我们概括了通过神经网络得到的参数合适的多重策略，而且提供和该方法有效的理论解释。在第5章节中，通过多个数值化实验，我们描述了该方法惊人的可行性和准确率。

## 2 场景：有摩擦的时间不连续的市场

现在考虑一个不连续的金融市场，他有有限的水平时间T，和交易时间$0 = t_0 < t_1 < ... < t_n = T$ ，固定一个有限的概率空间$\Omega = {\omega_1 , ... , \omega_N}$ , 和概率策略$\mathbb{P}$， 该测度满足对所有的 i 都有 $\mathbb{P}[{\omega_i}]>0$ ，我们定义所有的对$\Omega$的随机变量集合$\mathcal{X} : = \{ X : \Omega \to \mathbb{R} \}$ 

我们使用 $I_k$ 来标记在时间 $t_k$ 时刻的任何可用的新市场信息的价值 $\mathbb{R}^r$ ，包括市场交易费用和流动工具的中间价格 - 通常在例如隐含波动率 - 新闻，权衡负债表信息，交易信号，风险限制等的备份数据项中引用。$I = ( I_k )_{k=0,...,n}$ 这一过程生成过滤方法 $\mathbb{F} = ( \mathcal{F}_k )_{k=0,...,n}$ ，等，$ \mathcal{F}_k $ 表示到时间 $t_k$ 时候所有的可用信息。注意每个可测量的 $\mathcal{F}_k$ 随机变量都能够通过方法 $I_0 , ... ,I_k$ 来写出。这样在时间点 $t_k$ 的任何决策就会有很多可用特征集合。

市场包含有通过 $\mathbb{R}^d - valued \mathbb{F} - adapted$ 随机过程 $S = (S_k)_{k=0,...,n}$ 给定的中间价格的d 个对冲工具。我们不需要存在一个在$S$是一个鞅的条件下的相等的鞅测度。我们强调我们的对冲工具不是简单对像股票那样的初级资产，而且也对初级资产的流动性资产这种二级资产有效。一些这种对冲工具因此在未来时间点之前不能交易。（例如一个期权到期为6个月，但是只有3个月的数据信息），这种流动性限制也随着交易费用被建模。

我们对衍生品表示负债的投资组合是一个 $\mathcal{F}_T$ 测度的随机变量 Z ，为了与经典保持一致，我们可能参考这个作为或有债券，但是我们强调这意味着表示一个混合了流动性和OTC衍生品的投资组合。到期日 T 是所有工具的最大到期日，其中所有的支付点都是已知的。

不需要经典的衍生品价格模型来衡量 Z 和计算任一点的 Greeks。

### 2.1 简化

为了符号简单化，我们假设所有使用（本地）当晚的无风险利率的及时支付都是会发生。这本质上表示我们可能会假设例如是0和所有的支付都会在 T 时刻支付。我们也排除为了本文的目的而带有实际性选择的工具，例如美式期权。最后，我们也假设所有的现货币转换都是无费用的，而且我们因此可以假设所有的工具以我们的参考货币结算。

### 2.2 交易策略

为了在时间 T 时刻对冲一个亏空的 Z ，我们可能会在 S 使用一个带有 $\delta_k = (\delta_k^1 , ... , \delta_k^d)$ 的$\mathbb{R}^d - valued \mathbb{F} - adapted$ 的随机过程$\delta = (\delta_k)_{k=0,...,n}$ ，其中 $\delta^i_k$ 表示代理人在时间$t_k$处持有的第 i 个资产。为了表示方便我们还定义$\delta_{-1} = \delta_n := 0$ 。

我们用$\mathcal{H}^u$表示交易策略中非限制的集合。然而，每个$\delta_k$都是可添加的交易限制的子集。这些限制是由于流动性，资产可用性，或者交易限制而出现的。他们也被用来在特定的期权可用之前限制其交易。在上面的只有3个月数据的期权中，不同的交易限制将会是{0}，知道第三个月这个时间点。为了整合这些效果，我们假设$\delta_k$是被限制到集合$\mathcal{H}_k$的，其中$\mathcal{H}_k$假设是连续的，$\mathcal{F}_k$ 可测的集合$H_k : \mathbb{R}^{d(k+1)} \to \mathbb{R}^d$，等,$\mathcal{H}_k := H_k(\mathbb{R}^{d(k+1)})$。我们规定$H_k(0) = 0$ 。

而且，对于非限制性的策略$\delta^u \in \mathcal(H)^u$，我们（依次）定义$ (H o {\delta}^u)_k := K_k((H o {\delta}^u)_0 , ... , {(H o {\delta}^u)}_{k-1} , {\delta}_k^u) $ 它的受约束"投影"到 $ {\mathcal{h}}_k $中。我们使用${\mathcal{H}} := (H o {\mathcal{H}}^u) \subset {\mathcal{H}}^u $来表示受限制的交易策略中的对应的非空集合。

例如 1 中假设 S 为一系列期权，而且使用${\mathcal{V}}^i_k(S^i_k)$来表示对每个期权在时间$t_k$时刻使用可用的不同市场参数而计算B-S中Vega的值。



<span color='red'>**未完待续**</span>